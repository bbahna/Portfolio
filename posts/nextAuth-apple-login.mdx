---
title: 'ì¡°ê¸ˆ í—¤ë§¨ NextAuth ì• í”Œ ì†Œì…œ ë¡œê·¸ì¸ apple login êµ¬í˜„ê¸°'
description: 'ì• í”Œ ê°œë°œì ì„¼í„°ì— ë“±ë¡í•˜ëŠ” ì˜ ì •ë¦¬ëœ ê¸€ë„ ìˆì—ˆìœ¼ë‚˜, ë‚˜ì˜ í—¤ë§¨ ì›ì¸ ì¤‘ ë§ì€ ì‹œê°„ì´ í™˜ê²½ ë³€ìˆ˜ ê°’ì„ ì˜ëª» ì§€ì •í•œ ê²ƒì— ìˆì—ˆë‹¤. ë˜í•œ ì¶”ê°€ì ìœ¼ë¡œ ê²½í—˜í–ˆë˜ ë²„ê·¸ë“¤ì„ ê¸°ë¡í•˜ê³ ì ë‚¨ê¹ë‹ˆë‹¤. ë‹¤ë“¤ í•œ ë²ˆì¯¤ì€ í—¤ë§¤ì§€ ì•Šì„ê¹Œ ì‹¶ì–´ìš”..'
date: '2024-06-18'
tags:
  [
    'AppleProvider',
    'NextAuth',
    'client_secret',
    'ê·¸ì €ê°ê²©',
    'ë¦¬ë‹¤ì´ë ‰íŠ¸',
    'ë²„ê·¸ê¸°ë¡',
    'ì†Œì…œë¡œê·¸ì¸',
    'ì• í”Œë¡œê·¸ì¸',
    'í™˜ê²½ë³€ìˆ˜',
  ]
category: 'Next'
thumbnail: /posts/nextAuth-apple-login.png
---

> ğŸ’¡ [ì• í”Œ ê°œë°œì ì„¼í„°ì— ë“±ë¡í•˜ëŠ” ì˜ ì •ë¦¬ëœ ê¸€](https://velog.io/@dngur9801/Next.js-%EC%82%BD%EC%A7%88%ED%95%98%EB%A9%B4%EC%84%9C-%EA%B5%AC%ED%98%84%ED%95%9C-Next-auth%EB%A1%9C-%EC%95%A0%ED%94%8C-%EC%86%8C%EC%85%9C-%EB%A1%9C%EA%B7%B8%EC%9D%B8-%EC%97%B0%EB%8F%99)ë„ ìˆì—ˆìœ¼ë‚˜, ë‚˜ì˜ í—¤ë§¨ ì›ì¸ ì¤‘ ë§ì€ ì‹œê°„ì´ í™˜ê²½ ë³€ìˆ˜ ê°’ì„ ì˜ëª» ì§€ì •í•œ ê²ƒì— ìˆì—ˆë‹¤.
> ë˜í•œ ì¶”ê°€ì ìœ¼ë¡œ ê²½í—˜í–ˆë˜ ë²„ê·¸ë“¤ì„ ê¸°ë¡í•˜ê³ ì ë‚¨ê¹ë‹ˆë‹¤. ë‹¤ë“¤ í•œ ë²ˆì¯¤ì€ í—¤ë§¤ì§€ ì•Šì„ê¹Œ ì‹¶ì–´ìš”..

## ì• í”Œ ë¡œê·¸ì¸ êµ¬í˜„ ì½”ë“œ

```jsx
// login.jsx
import { signIn, useSession } from 'next-auth/react';

const { data: session } = useSession();

<LoginButton onClick={() => signIn('apple')}>
	<AppleLogo />
	<LoginText>Appleë¡œ ë¡œê·¸ì¸</LoginText>
</LoginButton>;
```

```jsx
// app/api/auth/[...nextauth]/route.ts
import { createPrivateKey } from 'crypto';
import process from 'process';

import { SignJWT } from 'jose';
import NextAuth from 'next-auth';
import AppleProvider, { AppleProfile } from 'next-auth/providers/apple';

async function handler(req, res) {
	// AppleProvider clientSecret í† í° ìƒì„±
	const getAppleToken = async () => {
		const key = `-----BEGIN PRIVATE KEY-----\n${process.env.APPLE_PRIVATE_KEY}\n-----END PRIVATE KEY-----`;
		const appleToken = await new SignJWT({})
			.setAudience('https://appleid.apple.com')
			.setIssuer(process.env.APPLE_TEAM_ID!)
			.setIssuedAt(new Date().getTime() / 1000)
			.setExpirationTime(new Date().getTime() / 1000 + 3600 * 2)
			.setSubject(process.env.APPLE_ID!)
			.setProtectedHeader({
				alg: 'ES256',
				kid: process.env.APPLE_KEY_ID,
			})
			.sign(createPrivateKey(key));
		return appleToken;
	};

	return NextAuth(req, res, {
	  // ì• í”Œ ë¡œê·¸ì¸ ì‹œ, ì¿ í‚¤ í•„ìš”í•¨
		cookies: {
			pkceCodeVerifier: {
				name: 'next-auth.pkce.code_verifier',
				options: {
					httpOnly: true,
					sameSite: 'none',
					path: '/',
					secure: true,
				},
			},
		},
		providers: [
			AppleProvider({
				clientId: process.env.APPLE_ID!,
				clientSecret: await getAppleToken(),
				profile(profile: AppleProfile) {
					return {
						id: profile.sub,
						email: profile.email,
						from: 'apple',
					};
				},
			}),
		],
		callbacks: {
			async jwt({ token, user }) {
				return { ...token, ...user };
			},
			async session({ session, token }) {
				session.user = token as any;
				return session;
			},
		},
	});
}

export { handler as GET, handler as POST };
```

## ì• í”Œ ê°œë°œì ì„¼í„° ë¡œê·¸ì¸ ì´ˆê¸° ì„¤ì • (í™˜ê²½ ë³€ìˆ˜)

[](https://developer.apple.com/account/resources/identifiers/list)

### App IDs ì¶”ê°€

![](https://velog.velcdn.com/images/bbahna/post/f2355b06-ecde-4e43-86c7-1da6e0418fc5/image.png)

![](https://velog.velcdn.com/images/bbahna/post/72caa1bc-6be5-44fa-8b82-59043a11ef9d/image.png)

(Bundle IDëŠ” ë„ë©”ì¸ì„ ì—­ìˆœìœ¼ë¡œ í•´ì„œ ì‘ì„±í•˜ëŠ” ê²ƒ ì¶”ì²œ)

â†’ ì—¬ê¸°ì„œ í™˜ê²½ë³€ìˆ˜ `APPLE_TEAM_ID`ëŠ” App IDsì˜ App ID Prefix ì…ë‹ˆë‹¤.

![](https://velog.velcdn.com/images/bbahna/post/ddc2d239-ec04-4e48-b813-c0018d71c838/image.png)

### Services IDs ì¶”ê°€

![](https://velog.velcdn.com/images/bbahna/post/81f86888-0486-4e18-acd3-fec1f9b4f37c/image.png)
![](https://velog.velcdn.com/images/bbahna/post/c6ee946e-8768-44fe-9502-b9695f637f9d/image.png)

(App IDì˜ Bundle IDì™€ ì¤‘ë³µ ë¶ˆê°€)

â†’ ì—¬ê¸°ì„œ í™˜ê²½ë³€ìˆ˜ `APPLE_ID`ëŠ” Services IDsì˜ Identifier ì…ë‹ˆë‹¤.

![](https://velog.velcdn.com/images/bbahna/post/e77c9ffb-d854-42c4-b53d-5260c1dc11e1/image.png)

(Primary App IDëŠ” ì•ì„œ ì¶”ê°€í•œ App IDì™€ ì—°ê²°)

(Domains and Subdomainsì— ë„ë©”ì¸ì„ ì¶”ê°€í•˜ê³ , Return URLsì— https://(ë„ë©”ì¸ëª…)/api/auth/callback/appleìœ¼ë¡œ ì¶”ê°€)

### Keys ì¶”ê°€

![](https://velog.velcdn.com/images/bbahna/post/01869e7e-7c81-41ac-a76c-23db31424fbf/image.png)
![](https://velog.velcdn.com/images/bbahna/post/b296b596-87ca-47fa-bb60-99c2df920522/image.png)

(keyëŠ” ë‹¨ í•œ ë²ˆë§Œ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥í•˜ë‹ˆ ì¡°ì‹¬í•´ì•¼ í•œë‹¤.)

â†’ ì—¬ê¸°ì„œ í™˜ê²½ë³€ìˆ˜ `APPLE_KEY_ID`ëŠ” Keysì˜ Key ID ê°’ ì…ë‹ˆë‹¤.

![](https://velog.velcdn.com/images/bbahna/post/8ee36cb2-925e-4458-905b-d2ac50d3ea6a/image.png)
![](https://velog.velcdn.com/images/bbahna/post/25f0c968-b80f-4984-994b-2cd076f5e547/image.png)

â†’ ì—¬ê¸°ì„œ í™˜ê²½ë³€ìˆ˜ `APPLE_PRIVATE_KEY`ëŠ” View Key Detailsì—ì„œ Downloadí•œ íŒŒì¼ì˜ ë‚´ìš©ì…ë‹ˆë‹¤.

![](https://velog.velcdn.com/images/bbahna/post/2409f762-8a4c-425a-83d6-85dabb44f68a/image.png)

## ì¤‘ê°„ì¤‘ê°„ ë°œìƒí•œ ë²„ê·¸ ê¸°ë¡

1. invalid_request, Invalid web redirect url.

   - http://localhost ê°œë°œê³„ì—ì„œëŠ” í™•ì¸ ë¶ˆê°€í•˜ì—¬ Services IDsì— ì¶”ê°€í•œ ë„ë©”ì¸ìœ¼ë¡œ ë°°í¬í•´ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
     <img
     	src="https://velog.velcdn.com/images/bbahna/post/0453654e-0477-4951-a077-ebd81fc3d12e/image.png"
     	width="300"
     />

2. Try signing in with a different account.
   - `cookies: { ... }` ì½”ë“œ ì¶”ê°€ ì•ˆí•  ê²½ìš°, `https://{ë„ë©”ì¸ëª…}/api/auth/signin/error=OAuthCallback` ì´ë™ë˜ë©°, ì´ëŸ° í™”ë©´ì´ ëœ¹ë‹ˆë‹¤.
     <img
     	src="https://velog.velcdn.com/images/bbahna/post/f0e35e14-d180-4137-957d-74769f9e7f17/image.png"
     	width="300"
     />

## ì„¤ì • ì„±ê³µ ì‹œ ë³´ì—¬ì§€ëŠ” í™”ë©´

     <img
     	src="https://velog.velcdn.com/images/bbahna/post/491ac49a-1891-4e08-a611-4b01f4c26fdf/image.png"
     	width="300"
     />
     <img
     	src="https://velog.velcdn.com/images/bbahna/post/6e4763a3-63d1-4895-8375-5348b04572c5/image.png"
     	width="300"
     />

â†’ ì—¬ê¸°ì„œ `Apple IDë¥¼ ì‚¬ìš©í•´ {Services ID Description}ì— ë¡œê·¸ì¸í•˜ê¸°`ë¡œ ë³´ì—¬ì§‘ë‹ˆë‹¤.

---

_(ê°ê²©)_

![](https://velog.velcdn.com/images/bbahna/post/42896452-2906-49eb-965c-4487f193cd13/image.png)
